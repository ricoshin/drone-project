<html>
<head>
  <title>[Erle-brain2] Erle-brain + ROS</title>
  <basefont face="나눔고딕" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/303244 (ko-KR, DDL); Windows/6.1.7601 Service Pack 1 (Win64);"/>
  <style>
    body, td {
      font-family: 나눔고딕;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="1355"/>
<h1>[Erle-brain2] Erle-brain + ROS</h1>

<div>
<span><div><strong>Erle-brain2</strong></div><div><strong><br clear="none"/></strong></div><div><strong>Connecting</strong></div><div>wi-fi hotspot 잡아서 ssh로 연결</div><div>핫스팟은 5GHz대역(2.4GHz RC와 WiFi를 함께 사용.)</div><div>WiFi -&gt; autopilot과 통신 가능 / 로그 등의 파일전송 / GCS를 이용한 미션플래닝 / 비디오스트리밍 / 트론 컨트롤</div><div><strong><br clear="none"/></strong></div><div><strong>PWM</strong></div><div><span style="color: #000000; font-family: Ubuntu, &quot; helvetica neue&quot;, helvetica, arial, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; display: inline !important; float: none; background-color: #ffffff;">Each PWM channel has 25 mA current sink capability at 5V. </span></div><div><span style="color: #000000; font-family: Ubuntu, &quot; helvetica neue&quot;, helvetica, arial, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; display: inline !important; float: none; background-color: #ffffff;">he most typical devices that you could connect are: ESCs, servos, gimbal servos,...</span></div><div><span style="color: #000000; font-family: Ubuntu, &quot; helvetica neue&quot;, helvetica, arial, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; display: inline !important; float: none; background-color: #ffffff;">The PWM can be used for powering the system, refer to Power section.</span></div><div><strong><br clear="none"/></strong></div><div><strong>mavros</strong></div><div>MAVLink를 확장가능하게 만든 ROS 통신노드. UDP proxy로 GCS(Ground Control Station)와 통신.</div><div>- 시리얼 포트를 통해서 autopilot과 통신</div><div>- GCS를 위한 UDP proxy</div><div>- mavlink_ros와 호환 가능한 ROS토픽(Mavlink.msg)</div><div>- ROS-MAVLink 변환을 위한 플러그인 시스템</div><div>- 파라미터 조작툴</div><div>- 웨이포인트 조작툴</div><div><br clear="none"/></div><div>Audio jack은 out only인듯..</div><div><br clear="none"/></div><div>Wi-fi 2.4GHz RC</div><div>RC Input -&gt; 원격 컨트롤러와 연결?</div><div>Telemetry<span style="font-family: gotham, helvetica, arial, sans-serif; font-size: 14px;">(433 or 915 Mhz)</span> -&gt; GCS와의 정보공유 </div><div><br clear="none"/></div><div>Erle-Brain 1 : BBB(BeagleBoneBlack) + PXF(PixHawk Fire cape)</div><div>Erle-Brain 2 : Raspberry Pi2 + daughter board (sensor cape + other components)</div><div>Navio2 : Raspberry Pi2 + Navio2</div><div><br clear="none"/></div><div><br clear="none"/></div><div>PXF mini</div><div>Raspberry Pi에서 Dronecode의 APM flight stack을 지원하기 위한 open autopilot  쉴드.</div><div><br clear="none"/></div><div><hr/></div><div><br clear="none"/></div><div>ArduPilot</div><div><br clear="none"/></div><div><br clear="none"/></div><div><br clear="none"/></div><div><br clear="none"/></div><div><hr/></div><div><br clear="none"/></div><div><br clear="none"/></div><div>MAVROS node</div><div><span style="color: #000000; font-family: Menlo, Monaco, Consolas, &quot; courier new&quot;, monospace; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: pre-wrap; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; display: inline !important; float: none; background-color: #e5e5e5;">&gt;&gt;rosnode</span> <span style="box-sizing: border-box; font-weight: bold; color: #000000; font-family: Menlo, Monaco, Consolas, &quot; courier new&quot;, monospace; font-size: 13px; font-style: normal; font-variant: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: pre-wrap; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: #e5e5e5;">list</span><span style="font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; float: none; display: inline !important; background-color: #e5e5e5;"><span style="font-size: 13px;"><span style="font-family: Menlo, Monaco, Consolas, &quot;"><span style="color: #000000;"><br clear="none"/> /mavros</span></span></span></span></div><div><span style="background-color: #e5e5e5;"><span style="font-size: 13px;"><span style="font-family: Menlo, Monaco, Consolas, &quot;"><span style="color: #000000;">/rosout</span></span></span></span></div><div><span style="font-size: 13px;"><span style="font-family: Menlo, Monaco, Consolas, &quot;"><span style="background-color: #e5e5e5;"><span style="color: #000000;"><br clear="none"/></span></span></span></span></div><div><span style="color: #000000; font-family: Menlo, Monaco, Consolas, &quot; courier new&quot;, monospace; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: pre-wrap; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; display: inline !important; float: none; background-color: #e5e5e5;">&gt;&gt;rostopic list /diagnostics /mavlink/</span><span style="box-sizing: border-box; font-weight: bold; color: #000000; font-family: Menlo, Monaco, Consolas, &quot; courier new&quot;, monospace; font-size: 13px; font-style: normal; font-variant: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: pre-wrap; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: #e5e5e5;">from</span><span style="color: #000000; font-family: Menlo, Monaco, Consolas, &quot; courier new&quot;, monospace; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: pre-wrap; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; display: inline !important; float: none; background-color: #e5e5e5;">/mavlink/to /mavros/battery /mavros/fix /mavros/gps_vel /mavros/imu/atm_pressure /mavros/imu/data /mavros/imu/data_raw /mavros/imu/mag /mavros/imu/temperature /mavros/mission/waypoints /mavros/rc/</span><span style="box-sizing: border-box; font-weight: bold; color: #000000; font-family: Menlo, Monaco, Consolas, &quot; courier new&quot;, monospace; font-size: 13px; font-style: normal; font-variant: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: pre-wrap; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: #e5e5e5;">in</span><span style="color: #000000; font-family: Menlo, Monaco, Consolas, &quot; courier new&quot;, monospace; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: pre-wrap; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; display: inline !important; float: none; background-color: #e5e5e5;">/mavros/rc/</span><span style="box-sizing: border-box; font-weight: bold; color: #000000; font-family: Menlo, Monaco, Consolas, &quot; courier new&quot;, monospace; font-size: 13px; font-style: normal; font-variant: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: pre-wrap; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: #e5e5e5;">out</span><span style="color: #000000; font-family: Menlo, Monaco, Consolas, &quot; courier new&quot;, monospace; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; display: inline !important; float: none; background-color: #e5e5e5;"><br clear="none"/> /mavros/state<br clear="none"/> /mavros/time_reference<br clear="none"/> /rosout<br clear="none"/> /rosout_agg</span></div><div><span style="font-family: Menlo, Monaco, Consolas, '"><span style="background-color: #e5e5e5;"><br clear="none"/></span></span></div><div><br clear="none"/></div><div><hr/></div><div><br clear="none"/></div><div>Simulation</div><div><br clear="none"/></div><div>이번 섹션은 ROS/<span>Gazebo</span> 시뮬레이터가 ArduCopter의 외부 시뮬레이터로써 어떻게 사용되는지를 설명한다.</div><div>시뮬레이터의 주요 특징은 다음과 같다:</div><ul><li>시뮬레이션 안정성 및 결정론적(deterministic) UAV 반응 (step lock mechanism)</li><li>단순화된 ROS/<span>Gazebo</span> 시뮬레이션 launch. (SITL launch 스크립트인 sim_vehicle.sh에 넘겨주는 인자를 통해 모든 설정 변경 가능)</li><li>Hector's 플러그인에 의해 제공되는 GPS 센서 통합</li><li>MavProxy에서 지형참조 오버레이 맵 제공. 시뮬레이션 주변 환경과 비교하여 UAV에 위치하는 곳이 어딘지 보다 쉽게 파악가능.</li></ul><div><br clear="none"/></div><div>시작하기 앞서 장착하는(armed) 과정이 필요하다. 제공되는 기능 중 몇가지는 다음과 같다.</div><ul><li>선형 가속도, 각속도, 대기압, 고도를 제공하는 IMU(Inertial measurement unit - 관성 측정 유닛)</li><li>어느 방향을 향하고 있는지 알려주는 나침반</li><li>경도, 위도 ,고도를 알려주는 GPS</li><li>Erle-Copter에는 전방과 아랫쪽을 향하는 2대의 카메라, 2개의 초음파센서가 장착되며, 레이저 2D 센서와 depth camera를 포함시킬 수 있다.</li><li>조이스틱 조종을 허용</li></ul><div><br clear="none"/></div><div>이 어플리케이션들은 해당되는 ROS 토픽을 통해 데이터를 발행(publish)한다. LTS(Long time support - 장기지원) <span style="font-family: gotham, helvetica, arial, sans-serif; font-size: 14px;">ROS </span>버전인  Indigo와 호환가능.</div><div>본 시뮬레이터는 MAVROS 패키지를 포함한다. MAVROS는 MAVLink 통신 프로토컬을 사용하는 다양한 autopilot들을 위한 통신 드라이버를 제공한다.</div><div>또한 GCS(ground control station)을 위한 UDP MAVLink 브릿지를 제공한다.</div><div>이 프로토컬을 사용하여 ROS는 UAV에게 특정한 명령을 전송할 수 있으며, 이는 본 시뮬레이터의 근본적으로 특화된 기능이다.</div><div>로보틱스 알고리즘을 통해 생성된 네비게이션 명령은 MAVROS를 통하여 flight controller에게 직접적으로 전달될 수 있다.</div><div><br clear="none"/></div><div>step lock 매커니즘은 <span>Gazebo</span> 시뮬레이션이 Ardupilot으로부터 다음 모터 명령을 받을 때 까지 멈춰있도록 한다.</div><div>명령을 받으면 2.5ms(400Hz 업데이트 주기)만큼 진행시키고, 새로운 센서 측정치를 Ardupilot으로 다시 보낸다.</div><div>Gazebo에 있는 많은 제어 시뮬레이션과는 다르게, Ardupilot이 시뮬레이션 클럭의 마스터이다.</div><div><br clear="none"/></div><div><br clear="none"/></div><div><br clear="none"/></div><div><hr/></div><div><span style="box-sizing: border-box; font-weight: bold; color: #000000; font-family: Menlo, Monaco, Consolas, 'Courier New', monospace; font-size: 13px; font-style: normal; font-variant: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: pre-wrap; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: #e5e5e5;">cd</span><span style="color: #000000; font-family: Menlo, Monaco, Consolas, 'Courier New', monospace; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: pre-wrap; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; display: inline !important; float: none; background-color: #e5e5e5;"> ~/simulation/ardupilot/ArduCopter ../Tools/autotest/sim_vehicle.sh -j </span><span style="box-sizing: border-box; color: #2f9b92; font-family: Menlo, Monaco, Consolas, 'Courier New', monospace; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: pre-wrap; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: #e5e5e5;">4</span><span style="color: #000000; font-family: Menlo, Monaco, Consolas, 'Courier New', monospace; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: pre-wrap; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; display: inline !important; float: none; background-color: #e5e5e5;"> </span><span style="box-sizing: border-box; color: #000000; font-family: Menlo, Monaco, Consolas, 'Courier New', monospace; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: pre-wrap; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: #e5e5e5;">-f</span><span style="color: #000000; font-family: Menlo, Monaco, Consolas, 'Courier New', monospace; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; display: inline !important; float: none; background-color: #e5e5e5;"> <span>Gazebo</span> --map --console</span></div><div><br clear="none"/></div><div><span style="color: #000000; font-family: Menlo, Monaco, Consolas, 'Courier New', monospace; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; display: inline !important; float: none; background-color: #e5e5e5;">param load /home/john2nd/simulation/ardupilot/Tools/Frame_params/Erle-Copter.param</span></div><div><span style="font-size: 13px;"><span style="font-family: Menlo, Monaco, Consolas, 'Courier New', monospace;"><span style="background-color: #e5e5e5;"><span style="color: #000000;"><br clear="none"/></span></span></span></span></div><div><span style="font-size: 13px;"><span style="font-family: Menlo, Monaco, Consolas, 'Courier New', monospace;"><span style="background-color: #e5e5e5;"><span style="color: #000000;"><br clear="none"/></span></span></span></span></div><div><span style="color: #000000; font-family: Menlo, Monaco, Consolas, 'Courier New', monospace; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; display: inline !important; float: none; background-color: #e5e5e5;">roslaunch ardupilot_sitl_gazebo_plugin erlecopter_spawn.launch</span></div><div><span style="font-size: 13px;"><span style="font-family: Menlo, Monaco, Consolas, 'Courier New', monospace;"><span style="background-color: #e5e5e5;"><span style="color: #000000;"><br clear="none"/></span></span></span></span></div><div><pre style="box-sizing: border-box; overflow: auto; font-family: Menlo, Monaco, Consolas, 'Courier New', monospace; font-size: 13px; display: block; padding: 10px 30px; margin: 0px -20px 10px; word-break: break-all; word-wrap: break-word; color: #333333; border: none; border-radius: 0px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: #e5e5e5;" xml:space="preserve"><code style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, 'Courier New', monospace; font-size: inherit; padding: 0.5em; color: #000000 !important; border-radius: 0px; white-space: pre-wrap; border: none; display: block; background: 0px 0px;">roslaunch mavros mavlink_bridge.launch</code></pre><div style="box-sizing: border-box; color: #000000; font-family: Ubuntu, 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: #ffffff;"><div><br clear="none"/></div></div></div><div><hr/></div><div><br clear="none"/></div><div><span style="color: #111111; font-family: Ubuntu, Arial, 'libra sans', sans-serif; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; display: inline !important; float: none; background-color: #ffffff;">You can do this with </span><code style="margin: 0px; padding: 1px 5px; border: 0px; font-size: 13px; font-family: Consolas, Menlo, Monaco, 'Lucida Console', 'Liberation Mono', 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', 'Courier New', monospace, sans-serif; white-space: pre-wrap; color: #111111; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: #eff0f1;">sudo usermod -a -G dialout terrik</code><span style="color: #111111; font-family: Ubuntu, Arial, 'libra sans', sans-serif; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; display: inline !important; float: none; background-color: #ffffff;"> if terrik is your username.</span></div><div><div style="margin: 0px 0px 1em; padding: 5px; border: 0px; width: auto; max-height: 600px; overflow: auto; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: #eff0f1;"><div><span style="color: #111111;"><code style="margin: 0px; padding: 0px; border: 0px; font-size: 13px; font-family: Consolas, Menlo, Monaco, 'Lucida Console', 'Liberation Mono', 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', 'Courier New', monospace, sans-serif; background-color: #eff0f1;">sudo adduser terrik dialout</code></span></div><div><div style="margin: 0px 0px 1em; padding: 5px; border: 0px; font-size: 13px; width: auto; max-height: 600px; overflow: auto; font-family: Consolas, Menlo, Monaco, 'Lucida Console', 'Liberation Mono', 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', 'Courier New', monospace, sans-serif; color: #111111; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: #eff0f1;"><code style="margin: 0px; padding: 0px; border: 0px; font-size: 13px; font-family: Consolas, Menlo, Monaco, 'Lucida Console', 'Liberation Mono', 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', 'Courier New', monospace, sans-serif; background-color: #eff0f1;">groups terrik</code></div></div></div></div></span>
</div></body></html> 