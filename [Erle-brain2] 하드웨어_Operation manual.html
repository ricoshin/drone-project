<html>
<head>
  <title>[Erle-brain2] 하드웨어_Operation manual</title>
  <basefont face="나눔고딕" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/303244 (ko-KR, DDL); Windows/6.1.7601 Service Pack 1 (Win64);"/>
  <style>
    body, td {
      font-family: 나눔고딕;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="1574"/>
<h1>[Erle-brain2] 하드웨어_Operation manual</h1>

<div>
<span><div><span style="font-family: gotham,helvetica,sans-serif; font-size: 24px;"><span style="color: rgb(20, 113, 145);"><span style="font-family: '맑은 고딕';"><b>1. 커뮤니케이션</b></span></span><br/></span></div><div><span style="font-family: gotham,helvetica,sans-serif; font-size: 14px;"><br clear="none"/></span></div><div><strong><span style="font-family: gotham,helvetica,sans-serif; font-size: 18px;">1) 와이파이 동글</span></strong><br clear="none"/><span style="font-family: gotham,helvetica,sans-serif; font-size: 14px;">와이파이 동글을 이용해 얼브레인2를 이용할 핫스팟을 만들 수 있음. 기기 연결을 위해 케이블을 쓰지 않아도 됨. 얼브레인2는 (2.4GHz RC와 와이파이를 동시에 사용할 수 있도록) 5GHz 대역폭의 와이파이 핫스팟을 열도록 미리 세팅되어 있음.</span><br clear="none"/><span style="font-family: gotham,helvetica,sans-serif; font-size: 14px;">와이파이는 오토파일럿과의 소통, 로그 등 파일 전송, GCS를 이용한 미션 플랜, 비디오스트리밍, 드론 제어에 사용됨</span><br clear="none"/></div><div><br clear="none"/><strong><span style="font-family: gotham,helvetica,sans-serif; font-size: 18px;">2) 이더넷</span></strong><br clear="none"/><span style="font-family: gotham,helvetica,sans-serif; font-size: 14px;">이더넷 케이블을 꽂아 얼브레인2에 인터넷 접속 가능. 인터넷에 접속해 새 소프트웨어를 설치하거나, 로컬 네트워크에서 얼브레인에 접속 가능(다른 기기들과의 소통 가능함)</span><br clear="none"/><span style="font-family: gotham,helvetica,sans-serif; font-size: 14px;">* 얼브레인2는 네트워크 DHCP 서버로부터 IP 어드레스를 기본값으로 얻음</span><br clear="none"/></div><div><span style="font-family: gotham,helvetica,sans-serif; font-size: 14px;"><br clear="none"/></span></div><div><span style="font-family: gotham,helvetica,sans-serif; font-size: 14px;">cf. DHCP(Dynamic host configuration;동적 호스트 구성 프로토콜) : 조직 내 네트워크 상에서 IP 주소를 중앙에서 관리하고 할당해줄 수 있도록 해주는 프로토콜.</span><br clear="none"/><br clear="none"/><strong><span style="font-family: gotham,helvetica,sans-serif; font-size: 18px;">3) 마이크로 SD 카드</span></strong><br clear="none"/><span style="font-family: gotham,helvetica,sans-serif; font-size: 14px;">먼저, MicroSD  카드에 OS 이미지를 복사한 후(방법을 모르면 운영 체제(리눅스/맥/윈도우)에 따라 홈페이지의 링크 참고),</span><br clear="none"/><span style="font-family: gotham,helvetica,sans-serif; font-size: 14px;">구동하려는 os 이미지가 담긴 SD 카드를 SD 슬롯에 꽂음. 올바르게 플래시되어 있어야 함.</span><br clear="none"/><br clear="none"/><strong><span style="font-family: gotham,helvetica,sans-serif; font-size: 18px;">4) HDMI</span></strong><br clear="none"/><span style="font-family: gotham,helvetica,sans-serif; font-size: 14px;">얼브레인2만 사용하고자 할 때(단독 장치).  HMDI 포트와 연결할 스크린(디스플레이), usb 키보드와 마우스가 필요함.</span><br clear="none"/><br clear="none"/><strong><span style="font-family: gotham,helvetica,sans-serif; font-size: 18px;">5) PWM</span></strong><br clear="none"/><span style="font-family: gotham,helvetica,sans-serif; font-size: 14px;">얼 브레인2는 PWM 아웃풋으로 쓸 12개 채널 보유. 각각의 채널은 5V에 대해 25mA의 싱크전류량current sink capability를 가짐.(*1) 이들 채널에 ESCs(electronic speed controller;변속기), 서보, 짐벌서보(수평유지) 등의 기기를 일반적으로 연결함. PWM은 시스템 전원 공급용으로 쓸 수도 있음(power 섹션 참고)</span><br clear="none"/><span style="font-family: gotham,helvetica,sans-serif; font-size: 14px;">* 얼브레인 PWM 채널의 수직 3개핀은, 맨 위가  PWM 신호(~), 중간이 5V(+/빨간색),  아래가 GND(-/검은색)임(얼브레인 로고가 위로 오게 놓았을 때). 연결시 방향을 주의할 것.</span><br clear="none"/><span style="font-family: gotham,helvetica,sans-serif; font-size: 14px;">게임 콘솔 컨트롤러를 사용하려면 블루투스 동글을 연결해 이 기술을 활용 가능.</span><br clear="none"/></div><div><br clear="none"/></div><div>주 *1:</div><div>소스전류source current와 싱크전류sink current<br clear="none"/></div><div><br clear="none"/></div><div>소스전류: MCU가 전류를 내보내는 형태. 출력이 HIGH(1)가 되면 출력에서 부하(동작시키고자 하는 것)를 거쳐 GND로 전류가 흐르며, 이때 출력에서 낼 수 있는 최대 전류값.<br clear="none"/><br clear="none"/>
싱크전류: MCU가 전류를 받아들이는 형태. 출력이 LOW(0)가 되면 5V에서 부하(동작시키고자 하는 것)를 거쳐 출력으로 전류가 흐름. 이때를 싱크라 하며, 여기서 흐를 수 있는 최대 전류값.<br clear="none"/><br clear="none"/>
일반적으로 (Max Current(파손전류)가 40mA이고,) 소스전류, 싱크전류 모두 20mA 선에서 안정적으로 사용할 수 있다고 함.<br clear="none"/>
LED 구동은 싱크 전류 방식을 추천하기도 함. 싱크전류 방식은 사용되는 전류가 외부 전류라 MCU 내부 전원을 사용하지 않아 상대적으로 MCU 소모 전류가 낮고 걸리는 부하도 적기 때문.<br clear="none"/><a href="http://dokkodai.tistory.com/88" shape="rect" target="_blank">http://dokkodai.tistory.com/88</a>    <a href="http://binworld.kr/36" shape="rect" target="_blank">http://binworld.kr/36</a>    <a href="http://blog.daum.net/coltcolt/5723714" shape="rect" target="_blank">http://blog.daum.net/coltcolt/5723714</a>  <a href="http://m.blog.naver.com/yousk16/40050812052" shape="rect" target="_blank">http://m.blog.naver.com/yousk16/40050812052</a> <br clear="none"/><br clear="none"/>
일반적으로 전원은 부하로 전류를 공급하는 장치이나, 동작에 따라 부하측에서 전원 방향으로 전류가 거꾸로 흘러들어가기도 함. 이러한 전류는 정상 동작일 수 있으나, 때로는 과도한 전류로 전원이 제어능력을 상실해 고장을 일으키는 원인이 됨.<br clear="none"/><a href="http://blog.unsang.com/140" shape="rect" target="_blank">http://blog.unsang.com/140</a>   <a href="http://cluster1.cafe.daum.net/_c21_/bbs_search_read?grpid=9ys5&amp;fldid=4dRh&amp;datanum=280&amp;contentval=&amp;docid=9ys54dRh28020030622150943" shape="rect" target="_blank">http://cluster1.cafe.daum.net/_c21_/bbs_search_read?grpid=9ys5&amp;fldid=4dRh&amp;datanum=280&amp;contentval=&amp;docid=9ys54dRh28020030622150943</a>  <br clear="none"/></div><div><br clear="none"/></div><div><strong><span style="font-family: gotham,helvetica,sans-serif; font-size: 18px;">6) RC input</span></strong><br clear="none"/><span style="font-family: gotham,helvetica,sans-serif; font-size: 14px;">라디오 컨트롤(RC) 리시버는 채널 14(가장 왼쪽)에 연결되어야 함.</span><br clear="none"/><br clear="none"/><strong><span style="font-family: gotham,helvetica,sans-serif; font-size: 18px;">7) I2C</span></strong><br clear="none"/><span style="font-family: gotham,helvetica,sans-serif; font-size: 14px;">* DF13 커넥터에서 장치를 해제할 때 주의. 처음 몇 번은 커넥터가 뻑뻑할 수 있음</span><br clear="none"/><span style="font-family: gotham,helvetica,sans-serif; font-size: 14px;">얼브레인은 I2C 버스에 접속할 수 있는 I2C 커넥터를 2개 포함함.  이 I2C 버스에 나침반, 가스 센서, 온도 센서 등 다양한 센서와 기기를 연결할 수 있음.</span><br clear="none"/><br clear="none"/><strong><span style="font-family: gotham,helvetica,sans-serif; font-size: 18px;">8) Telemetry</span></strong><br clear="none"/><span style="font-family: gotham,helvetica,sans-serif; font-size: 14px;">콥터/플레인/로버는 텔레메트리를 이용해 지상 스테이션(또는 transmitter;전송기,송신기)과의 정보 공유를 지원.</span><br clear="none"/><span style="font-family: gotham,helvetica,sans-serif; font-size: 14px;">얼브레인2에서 텔레메트리 장치를 사용하는 두 가지 방법:</span></div><div><br clear="none"/><span style="font-family: gotham,helvetica,sans-serif; font-size: 14px;">     a) UART 포트에 연결.</span><br clear="none"/><span style="font-family: gotham,helvetica,sans-serif; font-size: 14px;">UART 포트로 텔레메트리를 연결하려면 오토파일럿 런치 파일에서<span style="font-family: gotham,helvetica,sans-serif; font-size: 14px; color: #999999;"><span style="font-family: gotham,helvetica,sans-serif; font-size: 14px;"><span style="font-family: gotham,helvetica,sans-serif; font-size: 14px;">( ~/apm.sh인 듯)</span></span></span> 다음을 수정(GCS에 연결하기 위함)</span><br clear="none"/><span style="font-family: gotham,helvetica,sans-serif; font-size: 14px;">$APM_BIN_DIR/ArduCopter.elf -A udp:127.0.0.1:6001 -C /dev/ttyAMA0 $FLAGS </span> <span style="font-family: gotham,helvetica,sans-serif; font-size: 14px;">(-C 이하 부분)</span><br clear="none"/><br clear="none"/><span style="font-family: gotham,helvetica,sans-serif; font-size: 14px;">     b) USB  포트 중 하나에 연결.</span><br clear="none"/><span style="font-family: gotham,helvetica,sans-serif; font-size: 14px;">USB 포트로 텔레메트리를 연결하려면 오토파일럿 런치 파일에서<span style="font-family: gotham,helvetica,sans-serif; font-size: 14px; color: #999999;"><span style="font-family: gotham,helvetica,sans-serif; font-size: 14px;"><span style="font-family: gotham,helvetica,sans-serif; font-size: 14px;">( ~/apm.sh인 듯)</span></span></span> 다음을 수정(GCS에 연결하기 위함) <span style="font-family: gotham,helvetica,sans-serif; font-size: 14px;">~/apm.sh)</span></span> <span style="font-family: gotham,helvetica,sans-serif; font-size: 14px;">$APM_BIN_DIR/ArduCopter.elf -A udp:127.0.0.1:6001 -C /dev/ttyUSB0 $FLAGS </span> <span style="font-family: gotham,helvetica,sans-serif; font-size: 14px;">(-C 이하 부분)</span><br clear="none"/><br clear="none"/></div><div><br/></div><div><span style="color: rgb(20, 113, 145);"><b><span style="font-family: '맑은 고딕';"><span style="font-size: 24px;">2. 전원 Power</span></span></b></span><br clear="none"/></div><div><br clear="none"/><strong><span style="font-size: 18px;">전원 모듈</span></strong><br clear="none"/>
'Power'라 쓰인 커넥터를 통해 리튬폴리머 배터리와 파워 모듈 연결. 이 방법은 배터리 전압 측정을 가능하게 함<br clear="none"/><br clear="none"/><strong><span style="font-size: 18px;">Micro USB</span></strong><br clear="none"/>
표준적인 5V 2A의 microUSB 충전기도 사용 가능. 기기 좌측의 커넥터 사용.<br clear="none"/><br clear="none"/><strong><span style="font-size: 18px;">ESC</span></strong><br clear="none"/>
서보 레일도 전원 공급원으로 사용될 수 있음.(PWM 아웃풋 채널)<br clear="none"/><br clear="none"/><strong>전원부의 ADC</strong>(Analog to Digital Converter)<br clear="none"/>
전원 커넥터는 배터리 레벨을 읽기 위해 두 개의 ADC 채널을 가짐. 이 커넥터를 쓰지 않는다면 커넥터의 가운데 두 개 핀을 센서/기기에 아날로그 전압을 알려주는 용도로 사용할 수 있음<span style="color: #999999;">(해석 정확치 않음)</span><br clear="none"/><br clear="none"/>
주의:</div><div>ADC의 인풋 범위는 0~5V임. 이 전압을 초과하는 것을 연결하지 않도록 함.</div><div><br/></div><div><br/></div><div><span style="color: rgb(20, 113, 145);"><b><span style="font-family: '맑은 고딕';"><span style="font-size: 24px;">3. 센싱 Sensing</span></span></b></span></div><div><br clear="none"/><strong><span style="font-size: 18px;">내부 센서</span></strong><br clear="none"/>
가속도계Accelerometer</div><div>자력계Magnetometer</div><div>자이로스코프Gyroscope</div><div>전자기압계Digital Barometer<br clear="none"/></div><div><br clear="none"/></div><div><br clear="none"/><strong><span style="font-size: 18px;">외부 센서</span></strong></div><div><br clear="none"/><span style="font-size: 18px;"><strong>1) Erle-GPS</strong></span><br clear="none"/>
GPS는 날씨와 관계없이 야외의 위치와 시간 정보를 제공하는 우주 기반의 위성 네비게이션 시스템. 6개 이상의 GPS 위성이 장애없이 관측되는 지구 어디에서든 작동.<br clear="none"/><br clear="none"/>
얼-GPS는 얼브레인2를 위해 디자인된 GPS임. 높은 감도와 낮은 전력 소비량을 결합한 GPS(미국의 범지구 위성항법 시스템)/QZSS(일본의 지역용 GNSS. 정밀도 높음)와 GLONASS(러시아의 범지구 위성항법시스템)를 위한 GNSS(위성을 이용한 전파항법 시스템) 엔진을 장착함. UART(GPS) 포트와 I2C(나침반) 포트를 필요로 하며, 이들 포트가 장치에 전원을 공급함.<br clear="none"/><br clear="none"/><br clear="none"/><strong><span style="font-size: 18px;">2) 카메라</span></strong><br clear="none"/>
얼브레인 2.0 카메라 모듈은 5M(5,038,848) 픽셀, 2593*1944 해상도의 사진 찍음. 사진 한 장의 크기는 약 2.4MB로 1GB에 약 425장임. 1분에 사진 1장을 찍는다면 1GB로 7시간 정도 찍을 수 있음. 시간당 144MB 또는 하루 3.3GB 비율임.<br clear="none"/><br clear="none"/>
카메라는 얼브레인의 중요한 부분임. 사진찍기뿐 아니라, FPV(first person view)나 원격조종에도 유용하게 쓰일 수 있음<br clear="none"/><br clear="none"/>
자동으로 런치되는 'raspicam_node'를 이용해 카메라의 이미지들이 ROS로 바로 들어감. 이미지를 보려면 다음 명령 입력<br clear="none"/>
    : rosservice call /camera/start_capture<br clear="none"/><br clear="none"/>
데스크탑 컴퓨터(또는 이미지를 보려는 어떤 기기든)에서는 ROS_MASTER_URI 환경 변수를 알맞게 설정해준 후 다음 명령 입력<br clear="none"/>
    # 어떤 ROS에서는 다음 명령이 작동하지 않을 수 있음<br clear="none"/>
    : rosrun image_view image_view image:=/camera/image _image_transport:=compressed<br clear="none"/><br clear="none"/><br clear="none"/><strong><span style="font-size: 18px;">3) 오디오</span></strong><br clear="none"/>
얼브레인2를 이용해 오디오를 재생하려면 잭 커넥터를 좌측 커넥터에 꽂음<br clear="none"/>
* 오디오 아웃풋 기본값은 HDMI임<br clear="none"/><br clear="none"/><strong>오디오 잭 아웃 활성화하기</strong><br clear="none"/></div><div>필요패키지 설치<br clear="none"/>
    : sudo apt-get install alsa-utils<br clear="none"/>
    : sudo apt-get install mpg321<br clear="none"/>
    : sudo apt-get install lame<br clear="none"/>
커널 모듈 사운드드라이버 활성화<br clear="none"/>
    : sudo modprobe snd-bcm2835<br clear="none"/>
오디오 아웃을 잭(analog)으로 설정<br clear="none"/>
    : sudo amixer cset numid=3 1<br clear="none"/>
(cf. n is 0=auto, 1=headphones, 2=hdmi)<br clear="none"/>
볼륨 조절을 위해<br clear="none"/>
    : sudo amixer cset numid=1 -- 80% (80대신 변경 가능)<br clear="none"/>
&quot;say&quot; 명령 설치 (*1)<br clear="none"/>
    : sudo apt-get install gnustep-gui-runtime<br clear="none"/>
    : <span style="text-decoration: underline;">sudo</span> say &quot;hello&quot;<br clear="none"/><br clear="none"/>
오디오 재생<br clear="none"/>
    : aplay erle.wav (파일 있을 때)<br clear="none"/>
    : mpg321 &quot;erle.mp3&quot; (파일 있을 때)<br clear="none"/></div><div><br clear="none"/></div><div>주 *1:<br clear="none"/></div><div>라즈베리파이 TTS(Text to Speech) 설정<br clear="none"/></div><div><a href="http://elinux.org/RPi_Text_to_Speech_(Speech_Synthesis)" shape="rect" target="_blank">http://elinux.org/RPi_Text_to_Speech_(Speech_Synthesis)</a><br clear="none"/></div><div><a href="http://walchko.github.io/posts/2016/03/text-to-speach-tts/" shape="rect" target="_blank">http://walchko.github.io/posts/2016/03/text-to-speach-tts/</a><br clear="none"/></div><div><a href="http://www.icbanq.com/pbloger/board_View.aspx?number=204&amp;boardNum=" shape="rect" target="_blank">http://www.icbanq.com/pbloger/board_View.aspx?number=204&amp;boardNum=</a><br clear="none"/></div><div>여러 소스들(say, festival, spd-say, espeak, pico)이 소개되는데, 이들 중 실행된 것은 다음임 :<br clear="none"/></div><div><br clear="none"/></div><div>sudo apt-get install gnustep-gui-runtime<br clear="none"/></div><div>sudo say &quot;hello world&quot;<br clear="none"/></div><div><br clear="none"/></div><div>sudo apt-get instal espeak</div><div>sudo espeak &quot;hello world&quot;  (한국어도 지원함)<br clear="none"/></div><div><br clear="none"/></div><div><a href="http://cafe.naver.com/openrt/1300" shape="rect" target="_blank">http://cafe.naver.com/openrt/1300</a> (설치시 참고)</div><div>pico2wave --wave test.wav &quot;hello world&quot; (pico) ( 실행 폴더에 wav 파일로 저장됨)<br clear="none"/></div><div><br clear="none"/></div><div>cf. 한국어 API<br clear="none"/></div><div><a shape="rect">http://m.blog.naver.com/spring1a/220733833898</a><br clear="none"/></div><div><a href="http://rsmang.com/63" shape="rect" target="_blank">http://rsmang.com/63</a></div><div><br/></div><div><br/></div><div><span style="color: rgb(20, 113, 145);"><b><span style="font-family: '맑은 고딕';"><span style="font-size: 24px;">4. LED 상태</span></span></b></span></div><div><br/></div><div>얼브레인2의 오토파일럿 상태에 다른 LED 코드. 3가지 정상 상태.</div><div><br clear="none"/><strong>1) 오토파일럿이 아직 런치되지</strong>(launched) 않았거나, 런치될 수 없음<br clear="none"/>
: 오토파일럿이 런치되지 않았다면 LED 세 개(초록(노랑)/주황(빨강)/파랑)가 모두 켜짐. 오토파일럿이 에러 때문에 런치되지 않았을 때도 마찬가지일 수 있음.<br clear="none"/><br clear="none"/><strong>2) 오토파일럿이 런치되었으나 아직 준비되지(armed) 않았음</strong><br clear="none"/>
: 오토파일럿이 런치되었으나 준비되지 않았을 때는 초록(노란)불이 켜지고 주황(빨간)불이 깜박임. 모든 장비(vehicle)가 armed/disarmed 상태를 갖지는 않음을 유념할 것(얼 로버, 얼 플레인).<br clear="none"/><br clear="none"/><strong>3) 오토파일럿이 런치되고 준비도(armed) 되었음</strong><br clear="none"/>
: 오토파일럿이 런치되고 준비되었을 때는 초록(노란)불과 주황(빨간)불이 켜짐.<br clear="none"/></div><div><br clear="none"/></div><div><span style="color: rgb(0, 0, 0);">cf.<br clear="none"/></span></div><div><span style="color: rgb(0, 0, 0);">launched - 부트 업. APM이 백그라운드에서 데몬으로 돌고, ros가 실행되고, 시스템 준비가 완료된 상태</span></div><div><span style="color: rgb(0, 0, 0);">armed - 비행 모드를 장착해 날 준비를 한 상태. 시동 건 상태.</span></div></span>
</div></body></html> 