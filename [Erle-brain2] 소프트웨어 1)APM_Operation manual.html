<html>
<head>
  <title>[Erle-brain2] 소프트웨어 1)APM_Operation manual</title>
  <basefont face="나눔고딕" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/303244 (ko-KR, DDL); Windows/6.1.7601 Service Pack 1 (Win64);"/>
  <style>
    body, td {
      font-family: 나눔고딕;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="1591"/>
<h1>[Erle-brain2] 소프트웨어 1)APM_Operation manual</h1>

<div>
<span><div><strong><span style="font-size: 24px;">APM</span></strong> (Application Performance Management)<br clear="none"/><br clear="none"/>요약 정리본 <br clear="none"/><a href="[Erle-brain2] Documentation Summary.html" shape="rect" target="_blank">[Erle-brain2] Documentation Summary</a><br clear="none"/><br clear="none"/><span style="font-size: 18px;"><strong>1) 바이너리 파일 컴파일 Compile Binaries</strong></span><br clear="none"/><br clear="none"/><strong><span style="font-size: 18px;">크로스 컴파일러</span></strong><br clear="none"/>오토파일럿 바이너리 파일은 꼭 얼브레인2에서 빌드하지 않아도 됨. 다른 컴퓨터에서 빌드해서 복사해도 되는데, 이를 크로스 컴파일이라 함.<br clear="none"/>바이너리 파일이 생성되면 /tmp/ArduCopter.build/ArduCopter.elf 로 저장됨</div><div><br clear="none"/><strong><span style="font-size: 18px;">사전 빌드 바이너리 파일</span></strong><br clear="none"/>다음 링크로부터 (얼 콥터, 얼 헥사콥터, 얼 로버, 얼 플레인, 미션 플래너, APM 플래너 등의) 최신 바이너리 파일을 다운받을 수 있음<br clear="none"/><a href="http://firmware.ardupilot.org/" shape="rect" target="_blank">http://firmware.ardupilot.org/</a><br clear="none"/></div><div><br clear="none"/></div><div><strong><span style="font-size: 18px;">바이너리 파일 로딩</span></strong><br clear="none"/></div><div>ssh를 통해 얼 브레인2에 새 바이너리 파일 복사<br clear="none"/></div><div>* 라즈베리 파이로 PXFmini를 쓰는 경우에는 바이너리 파일이 ~/PXFmini/ 폴더에 기본으로 로드되어 있음.<br clear="none"/></div><div><br clear="none"/></div><div><br clear="none"/></div><div><strong><span style="font-size: 18px;">2) 고급 설정 Advanced configuration</span></strong><br clear="none"/></div><div><br clear="none"/><strong><span style="font-size: 18px;">APM 오토파일럿 관리</span></strong><br clear="none"/>데비안에는 오토파일럿을 계속 실행하기 위한 서비스 있음. top 명령을 치면 실행되고 있는 태스크들을 볼 수 있는데, ArduCopter.elf 과 apm.sh도 그 서비스의 일부임.<br clear="none"/>기본으로 런치되는 오토파일럿 프레임은 쿼드 프레임quad-frame임.<br clear="none"/><br clear="none"/>APM 오토파일럿 중지 명령<br clear="none"/>    :sudo systemctl stop apm.service<br clear="none"/>APM 오토파일럿 시작 명령<br clear="none"/>    :sudo systemctl start apm.service<br clear="none"/>APM 오토파일럿 비활성화 명령(부팅시 실행되지 않게 함)<br clear="none"/>    :sudo systemctl disable apm.service<br clear="none"/>APM 오토파일럿 활성화 명령(부팅시 실행되게 함)<br clear="none"/>    :sudo systemctl enable apm.service<br clear="none"/>APM 오토파일럿 상태 확인/정보 획득 명령<br clear="none"/>    :sudo systemctl status apm.service<br clear="none"/><br clear="none"/><br clear="none"/><strong><span style="font-size: 18px;">APM 오토파일럿 런치 설정</span></strong><br clear="none"/>오토파일럿은 홈(/~/)에 있는 apm.sh 스크립트에 의해 런치됨. 이 파일을 편집해 오토파일럿을 어떻게 실행할지, 어떤 장치vehicle의 오토파일럿을 실행할지 선택할 수 있음.<br clear="none"/><br clear="none"/>./&lt;ArduCopter_executable_name.elf&gt; -A &lt;primary_telemetry_port&gt; -B &lt;GPS_port&gt; -C &lt;secondary_telemetry_port&gt;<br clear="none"/><br clear="none"/>많이 쓰이는 사례들: <br clear="none"/># ArduCopter.elf 런치, USB(192.168.7.1)로 데이터 전송, ttyo5 포트에 GPS 연결 (*1)<br clear="none"/>./ArduCopter.elf -A udp:192.168.7.1:6000 -B /dev/ttyO5 (영어대문자O)<br clear="none"/><br clear="none"/># ArduCopter_hexa.elf (헥사(6)프레임) 런치, wifi(10.0.0.2)로 데이터 전송, ttyo5 포트에 GPS 연결<br clear="none"/>./ArduCopter_hexa.elf -A udp:10.0.0.2:6000 -B /dev/ttyO5<br clear="none"/><br clear="none"/># ArduPlane.elf 런치, MAVROS 브릿지(127.0.0.1)로 데이터 전송, ttyo5 포트에 GPS 연결<br clear="none"/>./ArduPlane.elf -A udp:127.0.0.1:6001 -B /dev/ttyO5<br clear="none"/><br clear="none"/># ArduRover.elf 런치, USB0을 텔레메트리 포트로, wifi를 부차적 텔레메트리 포트로, ttyo5 포트에 연결된 GPS 사용<br clear="none"/>./ArduRover.elf -A /dev/ttyUSB0 -B /dev/ttyO5 -C udp:10.0.0.2:6000<br clear="none"/><br clear="none"/>* Ardu&lt;&gt;.elf 실행파일은 반드시 홈(/~/) 폴더에 있어야 함.<br clear="none"/><br clear="none"/>주 *1.<br clear="none"/>tty: teletypewritter. 사용자와 시스템 간을 중계하는 역할. 사용자와 시스템 사이 입출력은 모두 여기를 통해 이루어짐. 서버 시스템에 직접 연결된 장치에서 사용함.<br clear="none"/>cf. pts: 가상의 tty. telnet, ssh 등을 이용해 원격으로 접속할 경우<br clear="none"/><span style="color: #ff6600;">(?? ttyAMA0, ttyo5, ttyUSB0이 각각 무엇을 뜻하는지, 포트명에 연결된 장치 확인 방법은 무엇인지 보충 요망 ??)</span><br clear="none"/><br clear="none"/><strong><span style="font-size: 18px;">소스로부터 컴파일하기</span></strong><br clear="none"/>오토파일럿의 최신버전이나 다른 프레임/장치vehicle의 바이너리를 얻으러면 소스로부터 컴파일해야 함. <br clear="none"/>이더넷 케이블을 연결해 인터넷에 접속,<br clear="none"/>소스코드 복사 <br clear="none"/>cd ~/  &amp;&amp;  git clone https://github.com/erlerobot/ardupilot.git<br clear="none"/>또는 업데이트해 <br clear="none"/>cd ~/ardupilot  &amp;&amp;  git pull origin master<br clear="none"/>장치에 맞게 컴파일함. (코드는 홈페이지 참고)</div><div><br clear="none"/></div><div><br clear="none"/></div><div><strong><span style="font-size: 18px;">3) 도구 Tools</span></strong><br clear="none"/>이하 내용은 다음 노트에서 가져옴<br clear="none"/><a href="[Erle-brain2] Documentation Summary.html" shape="rect" target="_blank">[Erle-brain2] Documentation Summary</a><br clear="none"/><br clear="none"/>cf. MAV(micro air vehicles; 초소형비행체)<br clear="none"/><br clear="none"/><strong><span style="font-size: 18px;">MAVProxy</span></strong><br clear="none"/>UAV(무인항공기;unmanned aerial vehicle)를 전면 지원하는 GCS(지상관제장치;ground control station). </div><div>(APM처럼) MAVLink 프로토콜을 지원하는 모든 UAV를 위한 이동성과 확장성을 갖춘 미니멀한 GCS를 의도.<br clear="none"/>커맨드라인, 콘솔 베이스. 기본 GUI를 제공하는 플러그인 포함<br clear="none"/>컴퓨터의 수에 제한 없이 네트워크 가능.한<br clear="none"/>python, pyserial, select()함수를 지원하는 어떤 POSIX 운영체제에서도 실행가능(리눅스, OS X, 윈도우 등)<br clear="none"/>작은 넷북에서도 동작 가능한 경량 디자인<br clear="none"/>console, moving maps, joysticks, antenna trackers, Tab-completion(명령어 탭 자동완성) 등을 지원하는 다른 모듈들을 불러와 사용 가능<br clear="none"/><br clear="none"/><strong>설치</strong><br clear="none"/>sudo pip install MAVProxy<br clear="none"/><br clear="none"/><strong>용법</strong><br clear="none"/>mavproxy.py [options] (다양한 옵션들 있음. 옵션 '-h'로 확인)<br clear="none"/><br clear="none"/><br clear="none"/><strong><span style="font-size: 18px;">MAVExtract</span></strong><br clear="none"/>로그로부터 하나의 비행 모드를 추출함<br clear="none"/>비행모드를 여러번 바꿀 때마다 새로운 .BIN파일을 생성<br clear="none"/>모드 종류 : Manual, AUTO, LOITER, FBWA, RTL, STABILIZE, LAND, STEERING,HOLD, ALT_HOLD, CIRCLE, POSITION, GUIDED, ACRO and CRUISE<br clear="none"/>특정 비행 모드를 추출하기 위해서는 flag를 사용 : --mode MODE(MODE 자리에 추출할 비행 모드 씀)<br clear="none"/><br clear="none"/><strong>용법</strong>  <br clear="none"/>mavextract.py [-h] [--no-timestamps] [--robust] [--condition CONDITION] [--mode MODE] LOG [LOG ...]<br clear="none"/><br clear="none"/><strong>용례</strong> <br clear="none"/>mavextract.py 1.BIN --mode LAND<br clear="none"/>Processing 2/98.BIN<br clear="none"/>Creating LAND1.bin<br clear="none"/><br clear="none"/><span style="color: rgb(0, 0, 0);">(~/APM/logs 안에 (숫자).BIN 형식으로 로그파일 저장됨)</span><br clear="none"/></div><div><span style="color: rgb(0, 0, 0);"><span style="color: #ff6600;">(??라인별 의미??)</span><br clear="none"/></span></div><div><br clear="none"/></div><div><br clear="none"/><span style="font-size: 18px;"><strong>MAVFlightmodes</strong></span><br clear="none"/>로그파일에서 비행 모드가 변화할 때마다 시간기록과 모드 이름을 출력<br clear="none"/><br clear="none"/><strong>용법</strong><br clear="none"/>mavflightmodes.py [-h] LOG [LOG ...]<br clear="none"/><br clear="none"/><strong>용례</strong><br clear="none"/>mavflightmodes.py 1.BIN<br clear="none"/><br clear="none"/><br clear="none"/><span style="font-size: 18px;"><strong>MAVFlighttimes</strong></span><br clear="none"/>공중에서 보낸 총 시간을 출력. 3m/s를 기준으로 air time과 ground time을 구분. (경계값은 --groundspeed=argument로 변경 가능)<br clear="none"/><br clear="none"/><strong>용법</strong><br clear="none"/>mavflighttime.py [-h] [--condition CONDITION] [--groundspeed GROUNDSPEED] LOG [LOG ...]<br clear="none"/><br clear="none"/><strong>용례</strong><br clear="none"/>mavflightmodes.py 1.BIN<br clear="none"/><br clear="none"/><br clear="none"/><strong><span style="font-size: 18px;">MAVFlightview</span></strong><br clear="none"/>이미지로 GPS 위치를 보여줌. 위성 이미지(Google, MS, Yahoo등)를 다운로드하여 그 위에 비행경로를 그려줌.<br clear="none"/><br clear="none"/><strong>용법</strong><br clear="none"/>mavflightview.py [options]<br clear="none"/><br clear="none"/><strong>용례</strong><br clear="none"/>파일로 경로 저장할 때는 --imagefile &lt;name&gt; 플래그 추가.<br clear="none"/>python mavflightview.py --imagefile output.jpg 25.BIN<br clear="none"/><br clear="none"/>비행모드마다 다른 색깔로 경로를 그림. 하나의 모드에 대한 경로만 보고 싶을 경우 --mode &lt;MODE&gt; 플래그 추가.<br clear="none"/>python mavflightview.py --imagefile output.jpg --mode ALT_HOLD 25.BIN<br clear="none"/><br clear="none"/><br clear="none"/><span style="font-size: 18px;"><strong>MAVGraph</strong></span><br clear="none"/>비행 데이터를 그래프화 해줌. MAVProxy에서의 그래프 모듈과 정확히 같은 명령어.<br clear="none"/><br clear="none"/><strong>용법</strong><br clear="none"/>mavgraph.py [-h] [--no-timestamps] [--planner] [--condition CONDITION] [--labels LABELS] [--legend LEGEND] [--legend2 LEGEND2]  [--marker MARKER] [--linestyle LINESTYLE] [--xaxis XAXIS] [--multi] [--zero-time-base] [--flightmode FLIGHTMODE]  [--output OUTPUT]</div><div>&lt;LOG or FIELD&gt; [&lt;LOG or FIELD&gt; ...]<br clear="none"/><br clear="none"/><strong>용례</strong><br clear="none"/>mavgraph.py 1.BIN &quot;CTUN.BarAlt&quot; &quot;CTUN.Alt&quot; &quot;CTUN.DAlt&quot;<br clear="none"/><br clear="none"/>그래프의 배경색은 비행모드에 따라 달라짐(비행모드별 색깔은 홈페이지 참고). 그래프 배경색을 보고 모드 변경 내역 확인 가능.<br clear="none"/><br clear="none"/><br clear="none"/><span style="font-size: 18px;"><strong>MAVLogdump</strong></span><br clear="none"/>바이너리 로그를 읽을 수 있는 파일로 변환해줌. output을 지정해주지 않으면 표준 output으로 변환.<br clear="none"/><br clear="none"/><strong>용례</strong> (1.BIN이라는 로그파일이 있을 때 그 내용을 보려면)<br clear="none"/>mavlogdump.py 1.BIN &gt; 1.BIN.txt<br clear="none"/>cat 1.BIN.txt<br clear="none"/><br clear="none"/><br clear="none"/><span style="font-size: 18px;"><strong>MAVParams</strong></span><br clear="none"/>로그 파일에서 APM 파라미터를 찾아서 console에 보여줌<br clear="none"/><br clear="none"/><strong>용법</strong><br clear="none"/>mavparms.py [-h] [-c] LOG [LOG ...]<br clear="none"/><br clear="none"/><strong>용례</strong> <br clear="none"/>mavparms.py 1.BIN<br clear="none"/><br clear="none"/>비행 파라미터 전체 목록은 홈페이지 참고<br clear="none"/><br clear="none"/><br clear="none"/><span style="font-size: 18px;"><strong>MAVTogpx</strong></span><br clear="none"/>로그 파일로부터 GPS 데이터를 읽어서 GPX파일(구글어스 파일)로 저장.<br clear="none"/><br clear="none"/><strong>용법</strong><br clear="none"/>mavtogpx.py [-h] [--condition CONDITION] [--nofixcheck] LOG [LOG ...]<br clear="none"/><br clear="none"/><strong>용례</strong><br clear="none"/>mavtogpx.py 1.BIN<br clear="none"/><br clear="none"/>같은 디렉토리에 .gpx 확장자 파일 생성. 구글어스로 로드해 읽을 수 있음.<br clear="none"/><br clear="none"/><br clear="none"/><span style="font-size: 18px;"><strong>MAVTomfile</strong></span><br clear="none"/>MAVLink 로그 파일을 MATLAB m-file로 변환<br clear="none"/><br clear="none"/><strong>용법</strong><br clear="none"/>mavtomfile.py [-h] [--condition CONDITION] [-o OUTPUT] [--types TYPES] [--dialect DIALECT] LOG [LOG ...]<br clear="none"/><br clear="none"/><strong>용례</strong><br clear="none"/>mavtomfile.py 25.BIN <br clear="none"/>Processing 25.BIN<br clear="none"/>Creating m_25.m<br clear="none"/><br clear="none"/><br clear="none"/><span style="font-size: 18px;"><strong>STIL</strong></span><br clear="none"/>STIL(Software In The Loop) 시뮬레이터는 하드웨어 없이도 APM을 실행할 수 있도록 해줌. <br clear="none"/>일반적인 C++ 컴파일러를 사용하여 오토파일럿 코드를 빌드해, 네이티브 실행파일native(*1) executable(하드웨어없이 코드 동작 테스트 가능)을 제공.<br clear="none"/><br clear="none"/><strong>우분투에 설치하기</strong><br clear="none"/>APM wiki 링크 참고<br clear="none"/>http://ardupilot.org/dev/docs/setting-up-sitl-on-linux.html<br clear="none"/><br clear="none"/><strong>시뮬레이터 런치</strong><br clear="none"/>sim_vehicle.sh -w<br clear="none"/><br clear="none"/>주 *1<br clear="none"/>native code : 컴파일시 프로세스에서 해석가능한 기계어로 바로 표현. OS에 종속됨<br clear="none"/>&lt;-&gt; managed code<br clear="none"/><br clear="none"/></div></span>
</div></body></html> 