<html>
<head>
  <title>[ErleRobotics] MavLink</title>
  <basefont face="나눔고딕" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/303244 (ko-KR, DDL); Windows/6.1.7601 Service Pack 1 (Win64);"/>
  <style>
    body, td {
      font-family: 나눔고딕;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="1665"/>
<h1>[ErleRobotics] MavLink</h1>

<div>
<span><div><a href="https://www.gitbook.com/@erlerobotics" rev="en_rl_small">https://www.gitbook.com/@erlerobotics</a></div><div><br/></div><div><b><span style="font-size: 24px;">MAVLink Tutorial for Absolute Dummies (Part - I)</span></b></div><div><br/></div><div>MavLink message(msg)는 기본적으로 미션플래너와 같은 GCS에 의해 인코딩되는 byte의 스트림이다.</div><div>여기서 인코딩이란 패킷을 자료구조에 집어넣은 뒤, 약간의 error correction을 첨가하여 채널을 통해 보내는 것을 말한다.</div><div><br/></div><div>이 튜토리얼에서는 APM이나 PX4가 미션플래너와 어떻게 통신하는 것인지를 해부한다. C에 대한 배경지식만 있다면 바보도 할 수 있다.</div><div>참고) 미션플래너가 USB시리얼과 텔레메트리로 동시에 연결될 경우는 USB가 우선권을 갖는다.  </div><div><br/></div><div><b>MavLink 메세지의 구조</b></div><div>17바이트 길이의 MavLink 패킷의 구조는 다음과 같다.</div><div>총 메시지 길이(17) = 헤더(6) + payload(9) + checksum(2)</div><div><br/></div><div><img src="[ErleRobotics] MavLink_files/Image.png" type="image/png" style="height: auto;"/></div><div><br/></div><div><b>0번 바이트부터 5번 바이트까지 : </b><span style="font-family:gotham, helvetica, arial, sans-serif;font-size:14px;">헤더(6바이트)</span></div><div>0번 : 메세지 헤더. 새로운 패킷이 시작되는 것을 알림. 항상 0xFE</div><div>1번 : 페이로드의 길이를 나타냄 (9)</div><div>2번 : 순서를 나타내는 숫자 -- 1씩 카운트 증가. 255가 되면 0으로 돌아옴. 패킷이 손실되었을때 감지할 수 있도록 해줌. </div><div>3번 : System ID - 어떤 시스템이 이 메세지를 보내고 있는지를 나타냄 (1). 같은 네트워크 상의 서로 다른 MAV를 구별해줌.</div><div>4번 : Component ID- 시스템의 어떤 컴포넌트(예. <span style="font-family:gotham, helvetica, arial, sans-serif;font-size:14px;">IMU 또는 autopilot)</span>가 이 메세지를 보내고 있는지를 나타냄 (1).</div><div>5번 : Message ID 페이로드가 무엇을 의미하고 어떻게 디코딩될 수 있는지를 정의함. (예를 들어, 0인 경우는 heartbeat를 나타냄)</div><div><br/></div><div><b>6번비트부터 n+6번 비트까지</b></div><div>Variable Sized Payload (1바이트마다 하나씩. 0~255 범위.)</div><div>** Payload (실제 우리가 관심있는 데이터)</div><div><br/></div><div><b>n+7번비트부터 n+8번 비트까지</b></div><div>Checksum: 에러 수정용</div><div><br/></div><div><b>지원하는 데이터 타입 (array지원)</b></div><div><ul style="box-sizing: border-box; -webkit-tap-highlight-color: transparent; -webkit-font-smoothing: antialiased; padding: 0px 0px 0px 2em; margin-top: 0px; margin-bottom: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><li style="box-sizing: border-box; -webkit-tap-highlight-color: transparent; -webkit-font-smoothing: antialiased;"><span style="font-family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;"><span style="color: rgb(51, 51, 51);"><code style="box-sizing: border-box; -webkit-tap-highlight-color: transparent; -webkit-font-smoothing: antialiased; font-family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace; padding: 0.2em 0px; margin: 0px; border-radius: 3px; background-color: rgb(247, 247, 247);">char</code> - Characters / strings</span></span></li><li style="box-sizing: border-box; -webkit-tap-highlight-color: transparent; -webkit-font-smoothing: antialiased;"><span style="font-family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;"><span style="color: rgb(51, 51, 51);"><code style="box-sizing: border-box; -webkit-tap-highlight-color: transparent; -webkit-font-smoothing: antialiased; font-family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace; padding: 0.2em 0px; margin: 0px; border-radius: 3px; background-color: rgb(247, 247, 247);">uint8_t</code> - Unsigned 8 bit</span></span></li><li style="box-sizing: border-box; -webkit-tap-highlight-color: transparent; -webkit-font-smoothing: antialiased;"><span style="font-family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;"><span style="color: rgb(51, 51, 51);"><code style="box-sizing: border-box; -webkit-tap-highlight-color: transparent; -webkit-font-smoothing: antialiased; font-family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace; padding: 0.2em 0px; margin: 0px; border-radius: 3px; background-color: rgb(247, 247, 247);">int8_t</code> - Signed 8 bit</span></span></li><li style="box-sizing: border-box; -webkit-tap-highlight-color: transparent; -webkit-font-smoothing: antialiased;"><span style="font-family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;"><span style="color: rgb(51, 51, 51);"><code style="box-sizing: border-box; -webkit-tap-highlight-color: transparent; -webkit-font-smoothing: antialiased; font-family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace; padding: 0.2em 0px; margin: 0px; border-radius: 3px; background-color: rgb(247, 247, 247);">uint16_t</code> - Unsigned 16 bit</span></span></li><li style="box-sizing: border-box; -webkit-tap-highlight-color: transparent; -webkit-font-smoothing: antialiased;"><span style="font-family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;"><span style="color: rgb(51, 51, 51);"><code style="box-sizing: border-box; -webkit-tap-highlight-color: transparent; -webkit-font-smoothing: antialiased; font-family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace; padding: 0.2em 0px; margin: 0px; border-radius: 3px; background-color: rgb(247, 247, 247);">int16_t</code> - Signed 16 bit</span></span></li><li style="box-sizing: border-box; -webkit-tap-highlight-color: transparent; -webkit-font-smoothing: antialiased;"><span style="font-family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;"><span style="color: rgb(51, 51, 51);"><code style="box-sizing: border-box; -webkit-tap-highlight-color: transparent; -webkit-font-smoothing: antialiased; font-family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace; padding: 0.2em 0px; margin: 0px; border-radius: 3px; background-color: rgb(247, 247, 247);">uint32_t</code> - Unsigned 32 bit</span></span></li><li style="box-sizing: border-box; -webkit-tap-highlight-color: transparent; -webkit-font-smoothing: antialiased;"><span style="font-family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;"><span style="color: rgb(51, 51, 51);"><code style="box-sizing: border-box; -webkit-tap-highlight-color: transparent; -webkit-font-smoothing: antialiased; font-family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace; padding: 0.2em 0px; margin: 0px; border-radius: 3px; background-color: rgb(247, 247, 247);">int32_t</code> - Signed 32 bit</span></span></li><li style="box-sizing: border-box; -webkit-tap-highlight-color: transparent; -webkit-font-smoothing: antialiased;"><span style="font-family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;"><span style="color: rgb(51, 51, 51);"><code style="box-sizing: border-box; -webkit-tap-highlight-color: transparent; -webkit-font-smoothing: antialiased; font-family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace; padding: 0.2em 0px; margin: 0px; border-radius: 3px; background-color: rgb(247, 247, 247);">uint64_t</code> - Unsigned 64 bit</span></span></li><li style="box-sizing: border-box; -webkit-tap-highlight-color: transparent; -webkit-font-smoothing: antialiased;"><span style="font-family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;"><span style="color: rgb(51, 51, 51);"><code style="box-sizing: border-box; -webkit-tap-highlight-color: transparent; -webkit-font-smoothing: antialiased; font-family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace; padding: 0.2em 0px; margin: 0px; border-radius: 3px; background-color: rgb(247, 247, 247);">int64_t</code> - Signed 64 bit</span></span></li><li style="box-sizing: border-box; -webkit-tap-highlight-color: transparent; -webkit-font-smoothing: antialiased;"><span style="font-family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;"><span style="color: rgb(51, 51, 51);"><code style="box-sizing: border-box; -webkit-tap-highlight-color: transparent; -webkit-font-smoothing: antialiased; font-family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace; padding: 0.2em 0px; margin: 0px; border-radius: 3px; background-color: rgb(247, 247, 247);">float</code> - IEEE 754 single precision floating point number</span></span></li><li style="box-sizing: border-box; -webkit-tap-highlight-color: transparent; -webkit-font-smoothing: antialiased;"><span style="font-family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;"><span style="color: rgb(51, 51, 51);"><code style="box-sizing: border-box; -webkit-tap-highlight-color: transparent; -webkit-font-smoothing: antialiased; font-family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace; padding: 0.2em 0px; margin: 0px; border-radius: 3px; background-color: rgb(247, 247, 247);">double</code> - IEEE 754 double precision floating point number</span></span></li><li style="box-sizing: border-box; -webkit-tap-highlight-color: transparent; -webkit-font-smoothing: antialiased;"><span style="font-family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;"><span style="color: rgb(51, 51, 51);"><code style="box-sizing: border-box; -webkit-tap-highlight-color: transparent; -webkit-font-smoothing: antialiased; font-family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace; padding: 0.2em 0px; margin: 0px; border-radius: 3px; background-color: rgb(247, 247, 247);">uint8_t_mavlink_version</code> - 현재 MAVLink 버전을 읽어오기 위함. 보통 <code style="box-sizing: border-box; -webkit-tap-highlight-color: transparent; -webkit-font-smoothing: antialiased; font-family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace; padding: 0.2em 0px; margin: 0px; border-radius: 3px; background-color: rgb(247, 247, 247);">uint8_t</code> 필드와 같이 읽음.</span></span></li></ul></div><div>소프트웨어가 하는 일은 이 것이 유효한 메세지인지 확인하는 것이다. checksum을 체크해서 에러가 있음이 확인되면 메세지를 버린다.</div><div>이 것이 텔레메트리의 baud rate가 115,200bps가 아니라 57,600bps인 이유이다. 이 값이 낮을 수록 GCS를 업데이트하는 것은 늦어지겠지만</div><div>오류는 적어지게 된다. 만약 MavLink를 더 먼 거리에서 사용하고 싶다면, baudrate를 더 낮추는 것이 좋을 수 있다.</div><div>그러나 이론상으로 테스트된 baudrate 57,600 bps일 때, 3DR 텔레메트리 레디오로 1마일(1.6km) 반경정도의 커버리지를 갖는다.</div><div>고등학교때 배운 SNIR(Signal to noise ratio) 개념을 기억하라.. # 안배웠는데.. 뭘기억하니..</div><div><br/></div><div>이제 위에서 우리가 관심 있는 것들을 살펴보면 다음과 같다.</div><div>a) System ID (메세지의 소스) : 이 것은 무선 텔레메트리나 USB 포트를 통해 APM으로 메세지를 보내는 소스(예. 미션 플래너)이다.</div><div>                                             소프트웨어는 이 메세지가 자신을 위한 것인지 정기적으로 체크한다.</div><div>b) Component ID (시스템 안의 서브시스템) : 메인 시스템 안에 있는 어떤 서브시스템. 현재는 서브시스템이 없으므로 사용안한다.</div><div>c) Message ID : 이 메세지가 무엇에 관한 것인지를 나타냄. 이 튜토리얼에서는 'main message'로 친다.</div><div>d) Payload (실제 데이터) : 이 부분이 앙꼬이다! 실제 너가 원하는 것!</div><div><b><br/></b></div><div><b><br/></b></div><div><b>MavLink는 실제 어떻게 작동하는가</b></div><div><br/></div><div>Mavlink는 단순히 그냥 메세지이다. Micro Aerial Vehicle Link(MavLink)의 이름은 사실 어울리지 않는다.</div><div>꼭 공중 비행체만을 위한 것은 아니고 지상 로봇에도 사용될 수 있기 때문이다. 내 추측이 맞다면 copter에 처음 사용되어서 이런식으로 이름이 붙은 것 같다.</div><div><br/></div><div>이 &quot;메세지&quot;는 바이트로 이루어진 상수를 포함하는 데이터 묶음이다. APM은 하드웨어 인터페이스(텔레메트리나 UART 시리얼)를 통해</div><div>(공중에서부터) 스트리밍 바이트를 받아, 소프트웨어에서 메세지를 해독한다.</div><div>이 메세지는 우리가 추출할 payload를 포함하고 있다는 점을 주목하라.</div><div><br/></div><div>우리는 payload에 관심이 있지만, 그 것이 무엇을 나타내는지 알기위해 그 옆에 함께오는 message ID도 알아야 한다.</div><div>이 모든 것들에 앞어서, 코드에서 mavlink 메세지를 어떻게 해석하는지에 대한 몇가지 단계가 있다.</div><div><br/></div><div>1) 우리는 handlemessage라는 메소드를 가진다. 이 것이 너가 배우고 알아야할 것이다!</div><div>    GCS_MavLink.pde(<a href="https://github.com/erlerobot/ardupilot/blob/mastererle/ArduCopter/GCS_Mavlink.pde" rev="en_rl_minimal">https://github.com/erlerobot/ardupilot/blob/mastererle/ArduCopter/GCS_Mavlink.pde</a>)을 찾아봐라!</div><div><br/></div><div>     이 메소드는 기본적으로 패킷에게 묻는다 :</div><div>     야 패킷, 너 누구냐? 나를 위한 놈이냐 아니면 내 시스템 해킹하려는 놈이냐?</div><div>     너님을 허락하기 전에 SystemID와 Component ID를 먼저 읽어보겠음.</div><div><br/></div><div>     mavlink를 사용하는 모든 시스템은 System ID와 Component ID를 가지고 있음.</div><div>     예를 들어, 미션플래너와 너가 날리고있는 쿼드콥터는 처음부터 같은 시스템 ID를 갖고 있어야 함.</div><div>     Component ID는 APM이나 PX4에 붙어 있는 '하위 시스템'을 위한 거임.</div><div><br/></div><div>     주의 : 현재 시스템ID와 컴포넌트ID는 동일하도록 하드코딩되어 있음.</div><div><br/></div><div>     그래서, 너가 하나의 텔레메트리와 APM을 갖고 있는 하나의 콥터를 갖고 있다면, 암생각 말고 가서 즐겁게 날려라!</div><div>     미래에 콥터가 겁나 많이 날아댕겨도 시스템 ID이 한 쌍만 이루면 서로 헷갈릴 일이 없을 거다!</div><div><br/></div><div>2) payload 데이터는 메세지로부터 추출되어서 <b>packet</b>에 담긴다. 패킷은 정보의 '타입'에 기반한 데이터 구조이다.</div><div>     우리는 더이상 '메세지'라는 용어를 쓰지 않을 거다. 메세지라는 단어는 이제 안녕임. </div><div>     이제 우리의 관심은 포장된(패킹된) 'raw data'인 <b>패킷</b>이다.</div><div><br/></div><div>3) 패킷은 '적절한 데이터 구조'에 담긴다. 엄청 많은 데이터 구조체가 있다. 예를 들면, 롤,피치,요와 같은 애티튜드(자세), GPS, RC채널 등이 있다.</div><div>     비슷한 것들을 한데 묶어서 모듈화 시키고 이해하기 쉽게 만들어 놓은 것이다.</div><div>     이러한 데이터 구조는 메세지를 보내고 받는 끝 단(미션플래너와 APM)에서 &quot;100% 완전히 동일&quot;하다.</div><div>     아니라면 너의 콥터는 땅으로 처박을 것임.</div><div><br/></div><div>     여기서 mavlink GUI 생성기가 빛을 발함. 이 데이터 구조를 만들기 위해 코드 한줄 칠 필요가 없음!! 사실 전혀는 아니고 겁나 조금만 치면됨..</div><div><br/></div><div>여기까지는 쉬웠기를 바라겠음. 아니라면 다시 읽어라. 바보처럼 굴어도 좋다.</div><div>이제, 실질적인 것을 해보겠음. 마브링크로 양방향 메세지를 보낼 것임.</div><div>-&gt; GCS로부터 APM/PX4로, 혹은 그 반대 방향으로. (여기서 GCS는 미션 플래너 같이 너가 콥터와 통신하려고 사용하는 각자의 툴을 말하는 거임.)</div><div><br/></div><div><b>GCS에서 쿼드콥터로 보내기</b></div><div><br/></div><div>지금까지, 우리는 각각의 메세지(우리가 패킷이라고 부르기로 한 것. 우리에게 유용한 정보를 가지고 있는 녀석)는 메세지ID와 payload가 있고,</div><div>이들은 '적절한 타입'의 구조체에 담긴다는 것을 배웠음.</div><div>'main message' (또는 MAVLINK_MSG_ID_) 타입으로 넘어가서 이해한 다음에(??), 그걸 가지고  <span style="font-family:gotham, helvetica, arial, sans-serif;font-size:14px;">영구적 메모리(EEPROM)에 저장해볼거임.</span></div><div><br/></div><div>아래는 2013년 12월 기준, Arducopter 최신버전(3.0.1 RC5)에서 볼 수 있는 파라미터 들임.</div><div>모든 mavlink 메세지에 대한 'main_message' ID를 다 쓸라고 노력했음.</div><div><br/></div><div>각각의 'main message' 카테고리(아래 볼드체로 된 것들) 안에 보면, 그 안에 속하는 '서브 메세지'들이 있을거임.</div><div>서브메세지는 기본적으로 payload 정보와 그 것들을 어떻게 다뤄야하는지와 깊은 관련이 있음.</div><div>'바이크' 카테고리가 요마하, 스즈키, 할리 데이비슨 등을 포함하는 것과 같음.는</div><div>모든 main message 카테고리를 나열하겠지만, 서브 카테고리는 몇가지만 정리했음.</div><div>아쉬우면 너가 직접 찾아봐^^ 너가 지금까지 잘이해했으면 더이상 바보가 아님. ㅇㅋ?</div><div><br/></div><div><b>MAVLINK_MSG_ID (Block of main messages):</b></div><div><br/></div><div>1) <b>MAVLINK_MSG_ID_HEARTBEAT</b>: <b><span style="color: rgb(255, 102, 0);">//0</span></b></div><div>     a. 가장 중요한 메세지. GCS가 APM/PX4와 연결되있는지 확인하려고 1초마다 한번씩 계속 보내는 메세지.</div><div>        이 것은 파라미터 업데이트 시, 미션 플래너가 APM과 연결되어 있는지를 확실하게 해준다. </div><div>        만약 하트비트가 끊어지면 failsafe이 구동되어 콥터가 착륙하거나 미션을 계속하거나 홈으로 귀환하는 등의 행동을 수행할 수 있다.</div><div>        failsafe 옵션은 미션플래너 Configure/Setup Failsafe 옵션에서 키거나 끌 수 있다. 심장박동은 멈출 수가 없지 않은가? 대단히 적합한 이름이다!</div><div><br/></div><div>2) MAVLINK_MSG_ID_<b>REQUEST_DATA_STREAM</b>: <b><span style="color: rgb(255, 102, 0);">//66</span></b></div><div>     a. 센서, RC 채널, GPS 위치, 상태(status), 추가(Extra 1/2/3)</div><div><br/></div><div>3) MAVLINK_MSG_ID_<b>COMMAND_LONG: <span style="color: rgb(255, 102, 0);">// 76</span></b></div><div>     a. Loiter unlimited, RTL, Land, Mission start, Arm/Disarm, Reboot</div><div><br/></div><div>4) <b>SET_MODE: <span style="color: rgb(255, 102, 0);">//11</span></b></div><div>     a. 예) set_mode(packet.custom_mode);</div><div><br/></div><div>5) MAVLINK_MSG_ID_<b>MISSION_REQUEST_LIST: <span style="color: rgb(255, 102, 0);">//43</span></b></div><div>     a. 전체 웨이포인트 : 파라미터의 command_total 변수. 존재하는 웨이포인트의 개수를 저장한다. (홈 위치 제외)</div><div><br/></div><div>6) MAVLINK_MSG_ID_<b>MISSION_REQUEST: <span style="color: rgb(255, 102, 0);">//40</span></b></div><div>     a. MAV_CMD_ 열거형 멤버 : (MAV_CMD_)CHANGE_ALT, SET_HOME, CONDITION_YAW, TAKE_OFF, NAV_LOITER_TIME</div><div><br/></div><div>7) MAVLINK_MSG_ID_<b>MISSION_ACK: <span style="color: rgb(255, 102, 0);">//47</span></b></div><div>     a. 웨이포인트 전송 끄기</div><div><br/></div><div>8) MAVLINK_MSG_ID_<b>PARAM_REQUEST_LIST: <span style="color: rgb(255, 102, 0);">//21</span></b></div><div>     a. count_parameters (총 파라미터 갯수 카운트)</div><div><br/></div><div>9) MAVLINK_MSG_ID_<b>PARAM_REQUEST_READ: <span style="color: rgb(255, 102, 0);">//20</span></b></div><div>     a. 파라미터를 받아서 디코딩 (Param 이름과 ID를 받아서)</div><div><br/></div><div>10) MAVLINK_MSG_ID_<b>MISSION_CLEAR_ALL: <span style="color: rgb(255, 102, 0);">//45</span></b></div><div>     a. 미션 플래너에서 flight data 스크린을 사용할 때, 마우스 메뉴의 clear mission과 같음. APM/PX4의 EEPROM을 비움.</div><div><br/></div><div>11) MAVLINK_MSG_ID_<b>MISSION_SET_CURRENT: <span style="color: rgb(255, 102, 0);">//41</span></b></div><div>     a. 미션 중간에 활성화 명령을 바꾸기 위해 사용됨. 예를 들어 미션플래너의 구글맵 스크린을 클릭하고 Fly To Here를 눌렀을 경우.</div><div><br/></div><div>12) MAVLINK_MSG_ID_<b>MISSION_COUNT: <span style="color: rgb(255, 102, 0);">// 44</span></b></div><div>     a. 웨이포인트의 총 갯수를 저장 (홈 위치 제외)</div><div><br/></div><div>13) MAVLINK_MSG_ID_<b>MISSION_WRITE_PARTIAL_LIST: <span style="color: rgb(255, 102, 0);">//</span></b></div><div>     a. APM이 지금 명령을 받고 있음을 <span style="font-family:gotham, helvetica, arial, sans-serif;font-size:14px;">전역변수가 계속해서</span> 알리는도록 함. 중요한 파라미터가 세팅되는 도중에 다른 MavLink 액션을 피하기 위한 것임.</div><div><br/></div><div>14) MAVLINK_MSG_ID<b>_SET_MAG_OFFSETS: <span style="color: rgb(255, 102, 0);">//151</span></b> </div><div>     a. 컴파스 켈리브레이션 후에 msg_ofs_x,y,z 값을 APM/PX4의 EEPROM에 세팅.</div><div>         미션 플래너에 의해 자동적으로 이를 수행하거나 SOFTWARE CONFIGURATION의 Full Parameter List에 의해도 할 수 있다.</div><div><br/></div><div>15) MAVLINK_MSG_ID_<b>MISSION_ITEM: <span style="color: rgb(255, 102, 0);">//39</span></b></div><div><b><span style="color: rgb(255, 102, 0);">          </span></b></div><div><img src="[ErleRobotics] MavLink_files/스크린샷, 2016-08-16 161628.png" type="image/png" style="font-family: gotham, helvetica, arial, sans-serif; font-size: 14px; height: auto;"/></div><div><b><span style="color: rgb(255, 102, 0);"><br/></span></b></div><div style="margin-left:40px;"> 이 부분이 흥미로운 파트이다. 이 메세지는 실시간 액션을 위한 서브 메세지를 포함하며, 이는 웨이포인트와 그급 기능들을 세팅하는 등의 기능을 한다.</div><div style="margin-left:40px;">메세지는 아래와 같이 동작한다.</div><div><b>         a.</b> GCS로부터 Waypoint를 받아서 APM/PX4의 EEPROM에 저장한다.</div><div style="margin-left:40px;"><b>b.</b> 4개의 파라미터<span style="font-family:gotham, helvetica, arial, sans-serif;font-size:14px;">(예. </span><span style="font-family:gotham, helvetica, arial, sans-serif;font-size:14px;">Delay, HitRad, -, and Yaw Angle) +</span> LOITER_TIME<span style="font-family:gotham, helvetica, arial, sans-serif;font-size:14px;">(ID 역할) +</span><span style="font-family:gotham, helvetica, arial, sans-serif;font-size:14px;"> 위도, 경도, 고도(3차원 위치)를 보냄</span></div><div style="margin-left:40px;">    이 파라미터들은 코드 상에서 열거형 변수와 옵션(1=홈고도에 대한 상대고도 저장)으로 정의 된다.</div><div style="margin-left:40px;">    각각의 명령(또는 ID)는 각기 다른 파라미터 종류를 가질 수 있고, 이 ID에 대하여 정의된 파라미터가 없으면</div><div style="margin-left:40px;">    미션 플래너 상에서 컬럼에 'blank' 헤더로 나타날 수 있다.</div><div style="margin-left:40px;">    요약하면 모든 액션과 함께 보내지는 관심 파라미터는 다음과 같다 : 4개 파라미터 + (액션에 대한)ID + (Lat, Long, Alt)</div><div style="margin-left:40px;">    4개의 파라미터는 카메라 세팅이나 커메라 트리거, Loiter 시간과 같은 커스텀 액션같은 것들이 될 수 있다.</div><div style="margin-left:40px;"><b>c. 위 그림처럼 미션 플래너에서 각각의 ID는 웨이포인트를 정의한다.</b></div><div style="margin-left:40px;"><span style="font-family:gotham, helvetica, arial, sans-serif;font-size:14px;">    LOITER_TIME, LOITER_UNLIMITED, WAYPOINT 등이 다른 파라미터와 함께 전송되는 웨이포인트 들이다.</span></div><div style="margin-left:40px;"><b>d. 명심하라 </b>: 고도는 항상 홈 고도에 대한 상대 고도이다. (항상!)</div><div style="margin-left:40px;"><b>e.</b> Common.xml에 이 액션들을 정의하고 Python GUI 생성기를 사용하여 APM/PX4가 사용할 코드를 생성할 수 있다.</div><div style="margin-left:40px;">    이는 나중에 다루거나 포럼에서 나에게 어떻게 하는지 질문하기 바란다. 앞에서 언급했듯이, 4개의 파라미터에 너만의 파라미터를 추가할 수 있다.</div><div style="margin-left:40px;"><b>f.</b> APM이 이 메인커멘드 (MAVLINK_MSG_ID_MISSION_ITEM)을 받았으면, MavLink패킷으로부터 ID를 읽고 스위치-케이스 문을 실행한다.</div><div style="margin-left:40px;">   예를 들면, Liter turns, Set home, Loiter time, Repeat servo, Set servo와 같은 케이스이 있을 수 있다.</div><div><br/></div><div>16) MAVLINK_MSG_ID_<b>PARAM_SET: <span style="color: rgb(255, 102, 0);">//23</span></b></div><div>     a. 파라미터 세팅. 미션 플래너상에서 Full Parameter List에서 파라미터 값을 세팅할 수 있음을 기억하라.</div><div>        우리가 이 메인커멘드를 수행할때도 같은 효과를 갖는다. APM은 확인을 위해 데이터 값 세트를 보낸다.</div><div>        미션 플래너에서 'value set failed'라는 알림을 본적이 있는가? 그 순간 APM/PX4도 나중에 오프라인 분석을 위해서 같은 메세지를 로그에  남긴다.</div><div><br/></div><div>17) MAVLINK_MSG_ID_<b>RC_CHANNELS_OVERRIDE: <span style="color: rgb(255, 102, 0);">//70</span></b></div><div>     a. RC 채널 값을 오버라이드. HIL(Hardware-In-Loop) 시뮬레이션이나 GCS 상에서 <span style="font-family:gotham, helvetica, arial, sans-serif;font-size:14px;">GUI를 통해 완전한 위치 전환 제어를 위해 사용함</span></div><div><br/></div><div>18) MAVLINK_MSG_ID_<b>HIL_STATE: <span style="color: rgb(255, 102, 0);">//90</span></b></div><div>     a. HIL 시뮬레이션에 사용. </div><div><br/></div><div>19) MAVLINK_MSG_ID_<b>DIGICAM_CONFIGURE: <span style="color: rgb(255, 102, 0);">//</span></b></div><div><br/></div><div>20) MAVLINK_MSG_ID_<b>MOUNT_CONFIGURE: <span style="color: rgb(255, 102, 0);">//</span></b></div><div><br/></div><div>21) MAVLINK_MSG_ID_<b>MOUNT_CONTROL: <span style="color: rgb(255, 102, 0);">//</span></b></div><div><br/></div><div>22) MAVLINK_MSG_ID_<b>MOUNT_STATUS:<span style="color: rgb(255, 102, 0);">//</span></b></div><div>     a. So far, as the name suggests, configures the appropriate command settings as set      by the user.</div><div><br/></div><div>23) MAVLINK_MSG_ID_<b>RADIO</b>, MAVLINK_MSG_ID_<b>RADIO_STATUS</b>: //</div><div>     a. 텔레메트리나 USB의 주파수를 조사하여, 신호세기가 생각보다 약하거나 오차가 높아지면 보내고 받는 패킷 사이의 딜레이를 자동으로 조정.</div><div>         적응형 소프트웨어 플로우 컨트롤과 같음. APM C++코드에서 __mavlink_radio_t나 미션플래너 C#코드에서 mavlink_radio_t를 보라.</div><div>         둘 다 구조체로 정의 되어 있다.</div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><br/><div><br/></div></span>
</div></body></html> 